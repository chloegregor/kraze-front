---
import Layout from '../../layouts/Layout.astro';
import {getPieceUnique} from '../../lib/api/piece-unique.js';
import {getPieceUniques} from '../../lib/api/piece-uniques.js';
import PieceSwiper from '../../components/PieceSwiper.jsx';
import AddButton from '../../components/AddButton.jsx';

const {slug} = Astro.params;

export async function getStaticPaths(){
  const pieceuniques = await getPieceUniques();
  const slugs = pieceuniques.map(piece => piece.slug);
  return slugs.map(slug => ({
    params: {slug}
  }));
}

const piece = await getPieceUnique(slug);
console.log("voila ce qu'il y a dans la vue", piece.documentId);

const structuredData = {
  documentId: piece.documentId,
  product: piece.titre.toUpperCase(),
  taille: "TAILLE UNIQUE",
  price: piece.price,
  type: 'piece-unique',

}
console.log("Ajout au panier:", structuredData);

---

<Layout>
    <h1 class="lg:mt-[2em] lg:mb-[0em] mb-[2em] text-center">{piece.titre.toUpperCase()}</h1>
    <div class="lg:h-[calc(100vh-13em)] lg:flex lg:flex-col lg:justify-center">
      <div class="lg:w-[50em] w-[100%] m-auto">
        <PieceSwiper client:load piece={piece} />
      </div>
  </div>
  <div class="flex justify-center mt-[1em]">
          <div class="lg:w-[50%] flex flex-col items-center gap-[2em]">
            <p class=" text-center last-center">{piece.description} Envie d’un corset unique, brodé, ou dans un coloris spécifique ? <a href="/projet-custom" class="underline underline-offset-4 ">Contactez-nous</a>, nous vous ferons un devis !</p>
            <p class=" text-[1.6em]">{piece.price} €</p>


            <AddButton client:load product={structuredData} />
          </div>
        </div>

</Layout>
